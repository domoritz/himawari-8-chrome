{"version":3,"file":"bundle.js","sources":["node_modules/d3-queue/src/array.js","node_modules/d3-queue/src/queue.js","node_modules/d3-collection/src/map.js","node_modules/d3-collection/src/set.js","node_modules/d3-dispatch/src/dispatch.js","node_modules/d3-request/src/request.js","node_modules/d3-request/src/type.js","node_modules/d3-request/src/json.js","node_modules/d3-dsv/src/dsv.js","node_modules/d3-dsv/src/csv.js","node_modules/d3-dsv/src/tsv.js","src/main.js"],"sourcesContent":["export var slice = [].slice;\n","import {slice} from \"./array\";\n\nvar noabort = {};\n\nfunction Queue(size) {\n  if (!(size >= 1)) throw new Error;\n  this._size = size;\n  this._call =\n  this._error = null;\n  this._tasks = [];\n  this._data = [];\n  this._waiting =\n  this._active =\n  this._ended =\n  this._start = 0; // inside a synchronous task callback?\n}\n\nQueue.prototype = queue.prototype = {\n  constructor: Queue,\n  defer: function(callback) {\n    if (typeof callback !== \"function\" || this._call) throw new Error;\n    if (this._error != null) return this;\n    var t = slice.call(arguments, 1);\n    t.push(callback);\n    ++this._waiting, this._tasks.push(t);\n    poke(this);\n    return this;\n  },\n  abort: function() {\n    if (this._error == null) abort(this, new Error(\"abort\"));\n    return this;\n  },\n  await: function(callback) {\n    if (typeof callback !== \"function\" || this._call) throw new Error;\n    this._call = function(error, results) { callback.apply(null, [error].concat(results)); };\n    maybeNotify(this);\n    return this;\n  },\n  awaitAll: function(callback) {\n    if (typeof callback !== \"function\" || this._call) throw new Error;\n    this._call = callback;\n    maybeNotify(this);\n    return this;\n  }\n};\n\nfunction poke(q) {\n  if (!q._start) try { start(q); } // let the current task complete\n  catch (e) { if (q._tasks[q._ended + q._active - 1]) abort(q, e); } // task errored synchronously\n}\n\nfunction start(q) {\n  while (q._start = q._waiting && q._active < q._size) {\n    var i = q._ended + q._active,\n        t = q._tasks[i],\n        j = t.length - 1,\n        c = t[j];\n    t[j] = end(q, i);\n    --q._waiting, ++q._active;\n    t = c.apply(null, t);\n    if (!q._tasks[i]) continue; // task finished synchronously\n    q._tasks[i] = t || noabort;\n  }\n}\n\nfunction end(q, i) {\n  return function(e, r) {\n    if (!q._tasks[i]) return; // ignore multiple callbacks\n    --q._active, ++q._ended;\n    q._tasks[i] = null;\n    if (q._error != null) return; // ignore secondary errors\n    if (e != null) {\n      abort(q, e);\n    } else {\n      q._data[i] = r;\n      if (q._waiting) poke(q);\n      else maybeNotify(q);\n    }\n  };\n}\n\nfunction abort(q, e) {\n  var i = q._tasks.length, t;\n  q._error = e; // ignore active callbacks\n  q._data = undefined; // allow gc\n  q._waiting = NaN; // prevent starting\n\n  while (--i >= 0) {\n    if (t = q._tasks[i]) {\n      q._tasks[i] = null;\n      if (t.abort) try { t.abort(); }\n      catch (e) { /* ignore */ }\n    }\n  }\n\n  q._active = NaN; // allow notification\n  maybeNotify(q);\n}\n\nfunction maybeNotify(q) {\n  if (!q._active && q._call) q._call(q._error, q._data);\n}\n\nexport default function queue(concurrency) {\n  return new Queue(arguments.length ? +concurrency : Infinity);\n}\n","export var prefix = \"$\";\n\nfunction Map() {}\n\nMap.prototype = map.prototype = {\n  constructor: Map,\n  has: function(key) {\n    return (prefix + key) in this;\n  },\n  get: function(key) {\n    return this[prefix + key];\n  },\n  set: function(key, value) {\n    this[prefix + key] = value;\n    return this;\n  },\n  remove: function(key) {\n    var property = prefix + key;\n    return property in this && delete this[property];\n  },\n  clear: function() {\n    for (var property in this) if (property[0] === prefix) delete this[property];\n  },\n  keys: function() {\n    var keys = [];\n    for (var property in this) if (property[0] === prefix) keys.push(property.slice(1));\n    return keys;\n  },\n  values: function() {\n    var values = [];\n    for (var property in this) if (property[0] === prefix) values.push(this[property]);\n    return values;\n  },\n  entries: function() {\n    var entries = [];\n    for (var property in this) if (property[0] === prefix) entries.push({key: property.slice(1), value: this[property]});\n    return entries;\n  },\n  size: function() {\n    var size = 0;\n    for (var property in this) if (property[0] === prefix) ++size;\n    return size;\n  },\n  empty: function() {\n    for (var property in this) if (property[0] === prefix) return false;\n    return true;\n  },\n  each: function(f) {\n    for (var property in this) if (property[0] === prefix) f(this[property], property.slice(1), this);\n  }\n};\n\nfunction map(object, f) {\n  var map = new Map;\n\n  // Copy constructor.\n  if (object instanceof Map) object.each(function(value, key) { map.set(key, value); });\n\n  // Index array by numeric index or specified key function.\n  else if (Array.isArray(object)) {\n    var i = -1,\n        n = object.length,\n        o;\n\n    if (f == null) while (++i < n) map.set(i, object[i]);\n    else while (++i < n) map.set(f(o = object[i], i, object), o);\n  }\n\n  // Convert object to map.\n  else if (object) for (var key in object) map.set(key, object[key]);\n\n  return map;\n}\n\nexport default map;\n","import {default as map, prefix} from \"./map\";\n\nfunction Set() {}\n\nvar proto = map.prototype;\n\nSet.prototype = set.prototype = {\n  constructor: Set,\n  has: proto.has,\n  add: function(value) {\n    value += \"\";\n    this[prefix + value] = value;\n    return this;\n  },\n  remove: proto.remove,\n  clear: proto.clear,\n  values: proto.keys,\n  size: proto.size,\n  empty: proto.empty,\n  each: proto.each\n};\n\nfunction set(object, f) {\n  var set = new Set;\n\n  // Copy constructor.\n  if (object instanceof Set) object.each(function(value) { set.add(value); });\n\n  // Otherwise, assume it’s an array.\n  else if (object) {\n    var i = -1, n = object.length;\n    if (f == null) while (++i < n) set.add(object[i]);\n    else while (++i < n) set.add(f(object[i], i, object));\n  }\n\n  return set;\n}\n\nexport default set;\n","var noop = {value: function() {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _)) throw new Error;\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error;\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error;\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n; i < n; ++i) args[i] = arguments[i + 2];\n    this.apply(type, that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error;\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import {map} from \"d3-collection\";\nimport {dispatch} from \"d3-dispatch\";\n\nexport default function(url, callback) {\n  var request,\n      event = dispatch(\"beforesend\", \"progress\", \"load\", \"error\"),\n      mimeType,\n      headers = map(),\n      xhr = new XMLHttpRequest,\n      user = null,\n      password = null,\n      response,\n      responseType,\n      timeout = 0;\n\n  // If IE does not support CORS, use XDomainRequest.\n  if (typeof XDomainRequest !== \"undefined\"\n      && !(\"withCredentials\" in xhr)\n      && /^(http(s)?:)?\\/\\//.test(url)) xhr = new XDomainRequest;\n\n  \"onload\" in xhr\n      ? xhr.onload = xhr.onerror = xhr.ontimeout = respond\n      : xhr.onreadystatechange = function(o) { xhr.readyState > 3 && respond(o); };\n\n  function respond(o) {\n    var status = xhr.status, result;\n    if (!status && hasResponse(xhr)\n        || status >= 200 && status < 300\n        || status === 304) {\n      if (response) {\n        try {\n          result = response.call(request, xhr);\n        } catch (e) {\n          event.call(\"error\", request, e);\n          return;\n        }\n      } else {\n        result = xhr;\n      }\n      event.call(\"load\", request, result);\n    } else {\n      event.call(\"error\", request, o);\n    }\n  }\n\n  xhr.onprogress = function(e) {\n    event.call(\"progress\", request, e);\n  };\n\n  request = {\n    header: function(name, value) {\n      name = (name + \"\").toLowerCase();\n      if (arguments.length < 2) return headers.get(name);\n      if (value == null) headers.remove(name);\n      else headers.set(name, value + \"\");\n      return request;\n    },\n\n    // If mimeType is non-null and no Accept header is set, a default is used.\n    mimeType: function(value) {\n      if (!arguments.length) return mimeType;\n      mimeType = value == null ? null : value + \"\";\n      return request;\n    },\n\n    // Specifies what type the response value should take;\n    // for instance, arraybuffer, blob, document, or text.\n    responseType: function(value) {\n      if (!arguments.length) return responseType;\n      responseType = value;\n      return request;\n    },\n\n    timeout: function(value) {\n      if (!arguments.length) return timeout;\n      timeout = +value;\n      return request;\n    },\n\n    user: function(value) {\n      return arguments.length < 1 ? user : (user = value == null ? null : value + \"\", request);\n    },\n\n    password: function(value) {\n      return arguments.length < 1 ? password : (password = value == null ? null : value + \"\", request);\n    },\n\n    // Specify how to convert the response content to a specific type;\n    // changes the callback value on \"load\" events.\n    response: function(value) {\n      response = value;\n      return request;\n    },\n\n    // Alias for send(\"GET\", …).\n    get: function(data, callback) {\n      return request.send(\"GET\", data, callback);\n    },\n\n    // Alias for send(\"POST\", …).\n    post: function(data, callback) {\n      return request.send(\"POST\", data, callback);\n    },\n\n    // If callback is non-null, it will be used for error and load events.\n    send: function(method, data, callback) {\n      if (!callback && typeof data === \"function\") callback = data, data = null;\n      if (callback && callback.length === 1) callback = fixCallback(callback);\n      xhr.open(method, url, true, user, password);\n      if (mimeType != null && !headers.has(\"accept\")) headers.set(\"accept\", mimeType + \",*/*\");\n      if (xhr.setRequestHeader) headers.each(function(value, name) { xhr.setRequestHeader(name, value); });\n      if (mimeType != null && xhr.overrideMimeType) xhr.overrideMimeType(mimeType);\n      if (responseType != null) xhr.responseType = responseType;\n      if (timeout > 0) xhr.timeout = timeout;\n      if (callback) request.on(\"error\", callback).on(\"load\", function(xhr) { callback(null, xhr); });\n      event.call(\"beforesend\", request, xhr);\n      xhr.send(data == null ? null : data);\n      return request;\n    },\n\n    abort: function() {\n      xhr.abort();\n      return request;\n    },\n\n    on: function() {\n      var value = event.on.apply(event, arguments);\n      return value === event ? request : value;\n    }\n  };\n\n  return callback\n      ? request.get(callback)\n      : request;\n}\n\nfunction fixCallback(callback) {\n  return function(error, xhr) {\n    callback(error == null ? xhr : null);\n  };\n}\n\nfunction hasResponse(xhr) {\n  var type = xhr.responseType;\n  return type && type !== \"text\"\n      ? xhr.response // null on error\n      : xhr.responseText; // \"\" on error\n}\n","import request from \"./request\";\n\nexport default function(defaultMimeType, response) {\n  return function(url, callback) {\n    var r = request(url).mimeType(defaultMimeType).response(response);\n    return callback ? r.get(callback) : r;\n  };\n}\n","import type from \"./type\";\n\nexport default type(\"application/json\", function(xhr) {\n  return JSON.parse(xhr.responseText);\n});\n","function objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"]\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n]\"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns;\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I, c;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.slice(j + 1, i).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var k = 1;\n        c = text.charCodeAt(I++);\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.slice(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.slice(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && (a = f(a, n++)) == null) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    })).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return text == null ? \"\"\n        : reFormat.test(text += \"\") ? \"\\\"\" + text.replace(/\\\"/g, \"\\\"\\\"\") + \"\\\"\"\n        : text;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatRows: formatRows\n  };\n}\n","import dsv from \"./dsv\";\n\nvar csv = dsv(\",\");\n\nexport var csvParse = csv.parse;\nexport var csvParseRows = csv.parseRows;\nexport var csvFormat = csv.format;\nexport var csvFormatRows = csv.formatRows;\n","import dsv from \"./dsv\";\n\nvar tsv = dsv(\"\\t\");\n\nexport var tsvParse = tsv.parse;\nexport var tsvParseRows = tsv.parseRows;\nexport var tsvFormat = tsv.format;\nexport var tsvFormatRows = tsv.formatRows;\n","import {queue} from 'd3-queue';\nimport {json} from 'd3-request';\n\nvar BASE_URL = \"http://himawari8-dl.nict.go.jp/himawari8/img/\";\nvar INFRARED = \"INFRARED_FULL\";\nvar VISIBLE_LIGHT = \"D531106\";\nvar WIDTH = 550;\nvar BLOCK_SIZES = [1, 4, 8, 16, 20];\n\nvar IMAGE_QUALITY = 0.9;\nvar RELOAD_INTERVAL = 1*60*1000;  // 1 minutes\nvar RELOAD_TIME_INTERVAL = 10*1000;  // 10 seconds\nvar IMAGE_DATA_KEY = \"imageData\";\nvar CACHED_DATE_KEY = \"cachedDate\";\nvar CACHED_IMAGE_TYPE_KEY = \"cachedImageType\";\n\nvar isChromeExtension = window.chrome && chrome.app.getDetails();\n\n/**\n * Returns an array of objects containing URLs and metadata\n * for Himawari 8 image tiles based on a given date.\n * Options:\n * - date: Date object or Date string (YYYY-MM-DD HH:MM:SSZ)\n * - infrared: boolean (optional)\n * - zoom: number (default: 1)\n * - blocks: alternative to zoom, how many images per row/column (default: 1)\n *      Has to be a valid block number (1, 4, 8, 16, 20)\n *\n * @param  {Object}       options\n */\nfunction himawariURLs(options) {\n  options = options || {};\n  var baseURL = getBaseURL(options.infrared);\n  var date = resolveDate(options.date);\n\n  // Normalize our date\n  date = normalizeDate(date);\n\n  // Define some image parameters\n  var blocks = options.blocks || (options.zoom ? BLOCK_SIZES[options.zoom - 1] : BLOCK_SIZES[0]);\n  var level = blocks + 'd';\n  var time = [date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()].map(function(s) {return pad(s, 2)}).join(\"\");\n  var year = date.getUTCFullYear();\n  var month = pad(date.getUTCMonth() + 1, 2);\n  var day = pad(date.getUTCDate(), 2);\n\n  // compose URL\n  var tilesURL = [baseURL, level, WIDTH, year, month, day, time].join(\"/\");\n  var tiles = [];\n\n  for (var y = 0; y < blocks; y++) {\n    for (var x = 0; x < blocks; x++) {\n      var name = x + \"_\" + y + \".png\";\n      var url = tilesURL + \"_\" + name;\n\n      tiles.push({\n        name: name,\n        url: getCachedUrl(url),\n        x: x,\n        y: y\n      });\n    }\n  }\n\n  return {\n    tiles: tiles,\n    blocks: blocks,\n    date: date\n  };\n}\n\n/**\n * Returns base URL for Himawari-8 images\n * @param   {Boolean}   infrared  returns base URL for infrared images if true\n * @returns {String}              full base URL\n */\nfunction getBaseURL(infrared) {\n  var url = BASE_URL;\n  if (infrared) {\n    url += INFRARED;\n  } else {\n    url += VISIBLE_LIGHT;\n  }\n  return url;\n}\n\n/**\n * Takes a Date and normalizes it to ten minute intervals.\n * @param   {Date}  input   Date object\n * @returns {Date}          normalized Date object\n */\nfunction normalizeDate(date) {\n  date.setMinutes(date.getMinutes() - (date.getMinutes() % 10));\n  date.setSeconds(0);\n  return date;\n}\n\n/**\n * Parses a date.\n * @param   {string | Date} date  Date as string or date object\n * @returns {Date}                Date object\n */\nfunction resolveDate(date) {\n  if (typeof date === \"string\") {\n    // Don't use Date.parse because it doesn't work with YYYY-MM-DD HH:MM:SSZ\n    var parts = date.match(/(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})Z/);\n    parts[2] -= 1; //months are zero-based\n    return new Date(Date.UTC.apply(this, parts.slice(1)));\n  } else {\n    return date;\n  }\n}\n\n/**\n * Create a cached URL thanks to our friends at Google.\n * See https://gist.github.com/carlo/5379498\n */\nfunction getCachedUrl(url) {\n  // 5 days caching, in seconds\n  var cache = 5 * 24 * 60 * 60;\n  return \"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url=\" + url + \"&container=focus&refresh=\" + cache\n}\n\n/**\n * Pads a number with trailing zeros and makes it a string.\n */\nfunction pad(num, size) {\n  var s = num + \"\";\n  while (s.length < size) {\n    s = \"0\" + s;\n  }\n  return s;\n}\n\n/**\n * Get the date of the latest image by making an Ajax request to the servers from nict.go.jp.\n * @param   {boolean}  infrared  gets the latest infrared image\n * @returns {function}           callback function\n */\nfunction getLatestDate(infrared, cb) {\n  json(\"https://himawari-8.appspot.com/latest\" + (infrared ? \"?infrared=true\" : \"\"),\n    function(error, data) {\n      if (error) throw error;\n      var latest = data.date;\n      cb(resolveDate(latest + \"Z\"));\n    });\n}\n\n/**\n * Looks at the screen resolution and figures out a zoom level that returns images at a sufficient resolution.\n */\nfunction getOptimalNumberOfBlocks() {\n  var height = document.getElementById(\"output\").clientHeight * window.devicePixelRatio;\n  var minNumber = height/WIDTH;\n\n  for (var i = 0; i < BLOCK_SIZES.length; i++) {\n    var l = BLOCK_SIZES[i];\n    if (l > minNumber) {\n      return l;\n    }\n  }\n\n  return BLOCK_SIZES[BLOCK_SIZES.length - 1];\n}\n\n// the date that is currently loaded\nvar loadedDate = null;\nvar loadedType = null;\n\nfunction updateTimeAgo(date) {\n  var ago = (Date.now() - date.getTime()) / (1000 * 60);\n  document.getElementById(\"time\").innerHTML = \"<abbr title=\\\"\" + date + \"\\\">\" + Math.floor(ago) + \" minutes</abbr> ago\";\n}\n\n/**\n * Creates an image composed of tiles.\n * @param {Date object} date  The date for which to load the data.\n */\nfunction setImages(date, infrared) {\n  // no need to set images if we have up to date images and the image type has not changed\n  if (loadedDate && date.getTime() === loadedDate.getTime() &&  loadedType === (infrared ? INFRARED : VISIBLE_LIGHT)) {\n    return;\n  }\n\n  // if we haven't loaded images before, we want to show progress\n  var initialLoad = !localStorage.getItem(CACHED_DATE_KEY);\n\n  // get the URLs for all tiles\n  var result = himawariURLs({\n    date: date,\n    blocks: getOptimalNumberOfBlocks(),\n    infrared: infrared\n  });\n\n  var pixels = result.blocks * WIDTH;\n\n  var canvas = initialLoad ? document.getElementById(\"output\") : document.createElement(\"canvas\");\n  var ctx = canvas.getContext(\"2d\");\n  ctx.canvas.width = pixels;\n  ctx.canvas.height = pixels;\n\n  var q = queue();\n\n  // add image to canvas and call callback when done\n  function addImage(tile, callback) {\n    var img = new Image();\n    img.setAttribute(\"crossOrigin\", \"anonymous\");\n    img.onload = function() {\n      ctx.drawImage(img, tile.x * WIDTH, tile.y * WIDTH, WIDTH, WIDTH);\n      callback();\n    }\n    img.src = tile.url;\n  }\n\n  result.tiles.forEach(function(tile) {\n    q.defer(addImage, tile);\n  });\n\n  // wait for all images to be drawn on canvas\n  q.awaitAll(function(error) {\n    if (error) throw error;\n\n    if (!initialLoad) {\n      // copy canvas into output in one step\n      var output = document.getElementById(\"output\");\n      var outCtx = output.getContext(\"2d\")\n      outCtx.canvas.width = pixels;\n      outCtx.canvas.height = pixels;\n      outCtx.drawImage(canvas, 0, 0);\n    }\n\n    updateTimeAgo(result.date);\n    loadedDate = date;\n    loadedType = infrared ? INFRARED : VISIBLE_LIGHT;\n\n    // put date and image data in cache\n    var imageData = canvas.toDataURL(\"image/jpeg\", IMAGE_QUALITY);\n    localStorage.setItem(IMAGE_DATA_KEY, imageData);\n    localStorage.setItem(CACHED_DATE_KEY, date);\n    localStorage.setItem(CACHED_IMAGE_TYPE_KEY, infrared ? INFRARED : VISIBLE_LIGHT);\n  });\n}\n\n/* Asynchronously load latest image date and images for that date */\nfunction setLatestImages() {\n  if (!navigator.onLine) {\n    // browser is offline, no need to do this\n    return;\n  }\n\n  function cb(infrared) {\n    getLatestDate(infrared, function(latest) {\n      setImages(latest, infrared);\n    });\n  }\n\n  if (isChromeExtension) {\n    chrome.storage.sync.get({\n      imageType: VISIBLE_LIGHT\n    }, function(items) {\n      var infrared = items.imageType === INFRARED;\n      cb(infrared);\n    });\n  } else {\n    // if we are not in the extension, let's always load non infrared\n    cb(false);\n  }\n}\n\n/** Load image from local storage */\nfunction setCachedImage() {\n  var canvas = document.getElementById(\"output\");\n  var ctx = canvas.getContext(\"2d\");\n  var date = new Date(localStorage.getItem(CACHED_DATE_KEY));\n\n  var img = new Image();\n  img.onload = function() {\n    ctx.canvas.width = img.width;\n    ctx.canvas.height = img.height;\n    ctx.drawImage(img, 0, 0);\n\n    updateTimeAgo(date);\n    loadedDate = date;\n    loadedType = localStorage.getItem(CACHED_IMAGE_TYPE_KEY);\n  }\n  img.src = localStorage.getItem(IMAGE_DATA_KEY);\n}\n\n// check if there are new images form time to time\nwindow.setInterval(setLatestImages, RELOAD_INTERVAL);\n\n// also load a new image when we come back online\nwindow.addEventListener(\"online\", setLatestImages);\n\n// initial loading\nif (localStorage.getItem(CACHED_DATE_KEY)) {\n  setCachedImage();\n}\nsetLatestImages();\n\n// update the time ago\nwindow.setInterval(function() {\n  if (loadedDate) {\n    updateTimeAgo(loadedDate);\n  }\n}, RELOAD_TIME_INTERVAL);\n\n// hide some things if we are not a chrome extension\nif (isChromeExtension) {\n  document.body.className += \"extension\";\n  document.getElementById(\"go-to-options\").addEventListener(\"click\", function() {\n    chrome.runtime.openOptionsPage();\n  });\n}\n"],"names":["Queue","size","Error","this","_size","_call","_error","_tasks","_data","_waiting","_active","_ended","_start","poke","q","start","e","abort","i","t","j","length","c","end","apply","noabort","r","maybeNotify","undefined","NaN","queue","concurrency","arguments","Infinity","Map","map","object","f","each","value","key","set","Array","isArray","o","n","dispatch","_","Dispatch","parseTypenames","typenames","types","trim","split","name","indexOf","slice","hasOwnProperty","type","get","callback","noop","concat","push","url","respond","result","status","xhr","hasResponse","response","call","request","event","mimeType","responseType","headers","XMLHttpRequest","user","password","timeout","XDomainRequest","test","onload","onerror","ontimeout","onreadystatechange","readyState","onprogress","header","toLowerCase","remove","data","send","post","method","fixCallback","open","has","setRequestHeader","overrideMimeType","on","error","responseText","defaultMimeType","objectConverter","columns","Function","JSON","stringify","join","customConverter","row","inferColumns","rows","columnSet","Object","create","forEach","column","delimiter","parse","text","convert","parseRows","token","I","N","EOF","eol","EOL","charCodeAt","replace","k","delimiterCode","a","format","formatValue","formatRows","formatRow","reFormat","RegExp","himawariURLs","options","baseURL","getBaseURL","infrared","date","resolveDate","normalizeDate","blocks","zoom","BLOCK_SIZES","level","time","getUTCHours","getUTCMinutes","getUTCSeconds","s","pad","year","getUTCFullYear","month","getUTCMonth","day","getUTCDate","tilesURL","WIDTH","tiles","y","x","getCachedUrl","BASE_URL","INFRARED","VISIBLE_LIGHT","setMinutes","getMinutes","setSeconds","parts","match","Date","UTC","cache","num","getLatestDate","cb","json","latest","getOptimalNumberOfBlocks","height","document","getElementById","clientHeight","window","devicePixelRatio","minNumber","l","updateTimeAgo","ago","now","getTime","innerHTML","Math","floor","setImages","addImage","tile","img","Image","setAttribute","ctx","drawImage","src","loadedDate","loadedType","initialLoad","localStorage","getItem","CACHED_DATE_KEY","pixels","canvas","createElement","getContext","width","defer","awaitAll","output","outCtx","imageData","toDataURL","IMAGE_QUALITY","setItem","IMAGE_DATA_KEY","CACHED_IMAGE_TYPE_KEY","setLatestImages","navigator","onLine","isChromeExtension","chrome","storage","sync","imageType","items","setCachedImage","prototype","constructor","await","results","prefix","property","clear","keys","values","entries","empty","typename","T","copy","that","args","dsv","RELOAD_INTERVAL","RELOAD_TIME_INTERVAL","app","getDetails","setInterval","addEventListener","body","className","runtime","openOptionsPage"],"mappings":"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"}