{"version":3,"file":"bundle.js","sources":["node_modules/d3-queue/src/array.js","node_modules/d3-queue/src/noop.js","node_modules/d3-queue/src/queue.js","node_modules/d3-collection/src/map.js","node_modules/d3-collection/src/set.js","node_modules/d3-dispatch/src/dispatch.js","node_modules/d3-request/src/request.js","node_modules/d3-request/src/type.js","node_modules/d3-request/src/json.js","node_modules/d3-dsv/src/dsv.js","node_modules/d3-dsv/src/csv.js","node_modules/d3-dsv/src/tsv.js","src/main.js"],"sourcesContent":["export var slice = [].slice;\n","export default function() {}\n","import {slice} from \"./array\";\nimport noop from \"./noop\";\n\nvar noabort = {};\n\nfunction newQueue(concurrency) {\n  if (!(concurrency >= 1)) throw new Error;\n\n  var q,\n      tasks = [],\n      results = [],\n      waiting = 0,\n      active = 0,\n      ended = 0,\n      starting, // inside a synchronous task callback?\n      error = null,\n      notify = noop;\n\n  function poke() {\n    if (!starting) try { start(); } // let the current task complete\n    catch (e) { if (tasks[ended + active - 1]) abort(e); } // task errored synchronously\n  }\n\n  function start() {\n    while (starting = waiting && active < concurrency) {\n      var i = ended + active,\n          t = tasks[i],\n          j = t.length - 1,\n          c = t[j];\n      t[j] = end(i);\n      --waiting, ++active;\n      t = c.apply(null, t);\n      if (!tasks[i]) continue; // task finished synchronously\n      tasks[i] = t || noabort;\n    }\n  }\n\n  function end(i) {\n    return function(e, r) {\n      if (!tasks[i]) return; // ignore multiple callbacks\n      --active, ++ended;\n      tasks[i] = null;\n      if (error != null) return; // ignore secondary errors\n      if (e != null) {\n        abort(e);\n      } else {\n        results[i] = r;\n        if (waiting) poke();\n        else if (!active) notify(error, results);\n      }\n    };\n  }\n\n  function abort(e) {\n    var i = tasks.length, t;\n    error = e; // ignore active callbacks\n    results = undefined; // allow gc\n    waiting = NaN; // prevent starting\n\n    while (--i >= 0) {\n      if (t = tasks[i]) {\n        tasks[i] = null;\n        if (t.abort) try { t.abort(); }\n        catch (e) { /* ignore */ }\n      }\n    }\n\n    active = NaN; // allow notification\n    notify(error, results);\n  }\n\n  return q = {\n    defer: function(callback) {\n      if (typeof callback !== \"function\" || notify !== noop) throw new Error;\n      if (error != null) return q;\n      var t = slice.call(arguments, 1);\n      t.push(callback);\n      ++waiting, tasks.push(t);\n      poke();\n      return q;\n    },\n    abort: function() {\n      if (error == null) abort(new Error(\"abort\"));\n      return q;\n    },\n    await: function(callback) {\n      if (typeof callback !== \"function\" || notify !== noop) throw new Error;\n      notify = function(error, results) { callback.apply(null, [error].concat(results)); };\n      if (!active) notify(error, results);\n      return q;\n    },\n    awaitAll: function(callback) {\n      if (typeof callback !== \"function\" || notify !== noop) throw new Error;\n      notify = callback;\n      if (!active) notify(error, results);\n      return q;\n    }\n  };\n}\n\nexport default function(concurrency) {\n  return newQueue(arguments.length ? +concurrency : Infinity);\n}\n","export var prefix = \"$\";\n\nfunction Map() {}\n\nMap.prototype = map.prototype = {\n  constructor: Map,\n  has: function(key) {\n    return (prefix + key) in this;\n  },\n  get: function(key) {\n    return this[prefix + key];\n  },\n  set: function(key, value) {\n    this[prefix + key] = value;\n    return this;\n  },\n  remove: function(key) {\n    var property = prefix + key;\n    return property in this && delete this[property];\n  },\n  clear: function() {\n    for (var property in this) if (property[0] === prefix) delete this[property];\n  },\n  keys: function() {\n    var keys = [];\n    for (var property in this) if (property[0] === prefix) keys.push(property.slice(1));\n    return keys;\n  },\n  values: function() {\n    var values = [];\n    for (var property in this) if (property[0] === prefix) values.push(this[property]);\n    return values;\n  },\n  entries: function() {\n    var entries = [];\n    for (var property in this) if (property[0] === prefix) entries.push({key: property.slice(1), value: this[property]});\n    return entries;\n  },\n  size: function() {\n    var size = 0;\n    for (var property in this) if (property[0] === prefix) ++size;\n    return size;\n  },\n  empty: function() {\n    for (var property in this) if (property[0] === prefix) return false;\n    return true;\n  },\n  each: function(f) {\n    for (var property in this) if (property[0] === prefix) f(this[property], property.slice(1), this);\n  }\n};\n\nfunction map(object, f) {\n  var map = new Map;\n\n  // Copy constructor.\n  if (object instanceof Map) object.each(function(value, key) { map.set(key, value); });\n\n  // Index array by numeric index or specified key function.\n  else if (Array.isArray(object)) {\n    var i = -1,\n        n = object.length,\n        o;\n\n    if (f == null) while (++i < n) map.set(i, object[i]);\n    else while (++i < n) map.set(f(o = object[i], i, object), o);\n  }\n\n  // Convert object to map.\n  else if (object) for (var key in object) map.set(key, object[key]);\n\n  return map;\n}\n\nexport default map;\n","import {default as map, prefix} from \"./map\";\n\nfunction Set() {}\n\nvar proto = map.prototype;\n\nSet.prototype = set.prototype = {\n  constructor: Set,\n  has: proto.has,\n  add: function(value) {\n    value += \"\";\n    this[prefix + value] = value;\n    return this;\n  },\n  remove: proto.remove,\n  clear: proto.clear,\n  values: proto.keys,\n  size: proto.size,\n  empty: proto.empty,\n  each: proto.each\n};\n\nfunction set(object, f) {\n  var set = new Set;\n\n  // Copy constructor.\n  if (object instanceof Set) object.each(function(value) { set.add(value); });\n\n  // Otherwise, assume it’s an array.\n  else if (object) {\n    var i = -1, n = object.length;\n    if (f == null) while (++i < n) set.add(object[i]);\n    else while (++i < n) set.add(f(object[i], i, object));\n  }\n\n  return set;\n}\n\nexport default set;\n","var noop = {value: function() {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _)) throw new Error(\"illegal or duplicate type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n; i < n; ++i) args[i] = arguments[i + 2];\n    this.apply(type, that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import {map} from \"d3-collection\";\nimport {dispatch} from \"d3-dispatch\";\n\nexport default function(url, callback) {\n  var request,\n      event = dispatch(\"beforesend\", \"progress\", \"load\", \"error\"),\n      mimeType,\n      headers = map(),\n      xhr = new XMLHttpRequest,\n      user = null,\n      password = null,\n      response,\n      responseType,\n      timeout = 0;\n\n  // If IE does not support CORS, use XDomainRequest.\n  if (typeof XDomainRequest !== \"undefined\"\n      && !(\"withCredentials\" in xhr)\n      && /^(http(s)?:)?\\/\\//.test(url)) xhr = new XDomainRequest;\n\n  \"onload\" in xhr\n      ? xhr.onload = xhr.onerror = xhr.ontimeout = respond\n      : xhr.onreadystatechange = function(o) { xhr.readyState > 3 && respond(o); };\n\n  function respond(o) {\n    var status = xhr.status, result;\n    if (!status && hasResponse(xhr)\n        || status >= 200 && status < 300\n        || status === 304) {\n      if (response) {\n        try {\n          result = response.call(request, xhr);\n        } catch (e) {\n          event.call(\"error\", request, e);\n          return;\n        }\n      } else {\n        result = xhr;\n      }\n      event.call(\"load\", request, result);\n    } else {\n      event.call(\"error\", request, o);\n    }\n  }\n\n  xhr.onprogress = function(e) {\n    event.call(\"progress\", request, e);\n  };\n\n  request = {\n    header: function(name, value) {\n      name = (name + \"\").toLowerCase();\n      if (arguments.length < 2) return headers.get(name);\n      if (value == null) headers.remove(name);\n      else headers.set(name, value + \"\");\n      return request;\n    },\n\n    // If mimeType is non-null and no Accept header is set, a default is used.\n    mimeType: function(value) {\n      if (!arguments.length) return mimeType;\n      mimeType = value == null ? null : value + \"\";\n      return request;\n    },\n\n    // Specifies what type the response value should take;\n    // for instance, arraybuffer, blob, document, or text.\n    responseType: function(value) {\n      if (!arguments.length) return responseType;\n      responseType = value;\n      return request;\n    },\n\n    timeout: function(value) {\n      if (!arguments.length) return timeout;\n      timeout = +value;\n      return request;\n    },\n\n    user: function(value) {\n      return arguments.length < 1 ? user : (user = value == null ? null : value + \"\", request);\n    },\n\n    password: function(value) {\n      return arguments.length < 1 ? password : (password = value == null ? null : value + \"\", request);\n    },\n\n    // Specify how to convert the response content to a specific type;\n    // changes the callback value on \"load\" events.\n    response: function(value) {\n      response = value;\n      return request;\n    },\n\n    // Alias for send(\"GET\", …).\n    get: function(data, callback) {\n      return request.send(\"GET\", data, callback);\n    },\n\n    // Alias for send(\"POST\", …).\n    post: function(data, callback) {\n      return request.send(\"POST\", data, callback);\n    },\n\n    // If callback is non-null, it will be used for error and load events.\n    send: function(method, data, callback) {\n      if (!callback && typeof data === \"function\") callback = data, data = null;\n      if (callback && callback.length === 1) callback = fixCallback(callback);\n      xhr.open(method, url, true, user, password);\n      if (mimeType != null && !headers.has(\"accept\")) headers.set(\"accept\", mimeType + \",*/*\");\n      if (xhr.setRequestHeader) headers.each(function(value, name) { xhr.setRequestHeader(name, value); });\n      if (mimeType != null && xhr.overrideMimeType) xhr.overrideMimeType(mimeType);\n      if (responseType != null) xhr.responseType = responseType;\n      if (timeout > 0) xhr.timeout = timeout;\n      if (callback) request.on(\"error\", callback).on(\"load\", function(xhr) { callback(null, xhr); });\n      event.call(\"beforesend\", request, xhr);\n      xhr.send(data == null ? null : data);\n      return request;\n    },\n\n    abort: function() {\n      xhr.abort();\n      return request;\n    },\n\n    on: function() {\n      var value = event.on.apply(event, arguments);\n      return value === event ? request : value;\n    }\n  };\n\n  return callback\n      ? request.get(callback)\n      : request;\n}\n\nfunction fixCallback(callback) {\n  return function(error, xhr) {\n    callback(error == null ? xhr : null);\n  };\n}\n\nfunction hasResponse(xhr) {\n  var type = xhr.responseType;\n  return type && type !== \"text\"\n      ? xhr.response // null on error\n      : xhr.responseText; // \"\" on error\n}\n","import request from \"./request\";\n\nexport default function(defaultMimeType, response) {\n  return function(url, callback) {\n    var r = request(url).mimeType(defaultMimeType).response(response);\n    return callback ? r.get(callback) : r;\n  };\n}\n","import type from \"./type\";\n\nexport default type(\"application/json\", function(xhr) {\n  return JSON.parse(xhr.responseText);\n});\n","function objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"]\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n]\"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns;\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I, c;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.slice(j + 1, i).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var k = 1;\n        c = text.charCodeAt(I++);\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.slice(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.slice(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && (a = f(a, n++)) == null) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    })).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return reFormat.test(text) ? \"\\\"\" + text.replace(/\\\"/g, \"\\\"\\\"\") + \"\\\"\" : text;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatRows: formatRows\n  };\n}\n","import dsv from \"./dsv\";\n\nvar csv = dsv(\",\");\n\nexport var csvParse = csv.parse;\nexport var csvParseRows = csv.parseRows;\nexport var csvFormat = csv.format;\nexport var csvFormatRows = csv.formatRows;\n","import dsv from \"./dsv\";\n\nvar tsv = dsv(\"\\t\");\n\nexport var tsvParse = tsv.parse;\nexport var tsvParseRows = tsv.parseRows;\nexport var tsvFormat = tsv.format;\nexport var tsvFormatRows = tsv.formatRows;\n","import {queue} from 'd3-queue';\nimport {json} from 'd3-request';\n\nvar BASE_URL = \"http://himawari8-dl.nict.go.jp/himawari8/img/\";\nvar INFRARED = \"INFRARED_FULL\";\nvar VISIBLE_LIGHT = \"D531106\";\nvar WIDTH = 550;\nvar BLOCK_SIZES = [1, 4, 8, 16, 20];\n\nvar IMAGE_QUALITY = 0.9;\nvar RELOAD_INTERVAL = 1*60*1000;  // 1 minutes\nvar RELOAD_TIME_INTERVAL = 10*1000;  // 10 seconds\nvar IMAGE_DATA_KEY = \"imageData\";\nvar CACHED_DATE_KEY = \"cachedDate\";\n\n/**\n * Returns an array of objects containing URLs and metadata\n * for Himawari 8 image tiles based on a given date.\n * Options:\n * - date: Date object or Date string (YYYY-MM-DD HH:MM:SSZ)\n * - infrared: boolean (optional)\n * - zoom: number (default: 1)\n * - blocks: alternative to zoom, how many images per row/column (default: 1)\n *      Has to be a valid block number (1, 4, 8, 16, 20)\n *\n * @param  {Object}       options\n */\nfunction himawariURLs(options) {\n  options = options || {};\n  var baseURL = getBaseURL(options.infrared);\n  var date = resolveDate(options.date);\n\n  // Normalize our date\n  date = normalizeDate(date);\n\n  // Define some image parameters\n  var blocks = options.blocks || (options.zoom ? BLOCK_SIZES[options.zoom - 1] : BLOCK_SIZES[0]);\n  var level = blocks + 'd';\n  var time = [date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()].map(function(s) {return pad(s, 2)}).join(\"\");\n  var year = date.getUTCFullYear();\n  var month = pad(date.getUTCMonth() + 1, 2);\n  var day = pad(date.getUTCDate(), 2);\n\n  // compose URL\n  var tilesURL = [baseURL, level, WIDTH, year, month, day, time].join(\"/\");\n  var tiles = [];\n\n  for (var y = 0; y < blocks; y++) {\n    for (var x = 0; x < blocks; x++) {\n      var name = x + \"_\" + y + \".png\";\n      var url = tilesURL + \"_\" + name;\n\n      tiles.push({\n        name: name,\n        url: getCachedUrl(url),\n        x: x,\n        y: y\n      });\n    }\n  }\n\n  return {\n    tiles: tiles,\n    blocks: blocks,\n    date: date\n  };\n}\n\n/**\n * Returns base URL for Himawari-8 images\n * @param   {Boolean}   infrared  returns base URL for infrared images if true\n * @returns {String}              full base URL\n */\nfunction getBaseURL(infrared) {\n  var url = BASE_URL;\n  if (infrared) {\n    url += INFRARED;\n  } else {\n    url += VISIBLE_LIGHT;\n  }\n  return url;\n}\n\n/**\n * Takes a Date and normalizes it to ten minute intervals.\n * @param   {Date}  input   Date object\n * @returns {Date}          normalized Date object\n */\nfunction normalizeDate(date) {\n  date.setMinutes(date.getMinutes() - (date.getMinutes() % 10));\n  date.setSeconds(0);\n  return date;\n}\n\n/**\n * Parses a date.\n * @param   {string | Date} date  Date as string or date object\n * @returns {Date}                Date object\n */\nfunction resolveDate(date) {\n  if (typeof date === \"string\") {\n    // Don't use Date.parse because it doesn't work with YYYY-MM-DD HH:MM:SSZ\n    var parts = date.match(/(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})Z/);\n    parts[2] -= 1; //months are zero-based\n    return new Date(Date.UTC.apply(this, parts.slice(1)));\n  } else {\n    return date;\n  }\n}\n\n/**\n * Create a cached URL thanks to our friends at Google.\n * See https://gist.github.com/carlo/5379498\n */\nfunction getCachedUrl(url) {\n  // 5 days caching, in seconds\n  var cache = 5 * 24 * 60 * 60;\n  return \"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url=\" + url + \"&container=focus&refresh=\" + cache\n}\n\n/**\n * Pads a number with trailing zeros and makes it a string.\n */\nfunction pad(num, size) {\n  var s = num + \"\";\n  while (s.length < size) {\n    s = \"0\" + s;\n  }\n  return s;\n}\n\n/**\n * Get the date of the latest image by making an Ajax request to the servers from nict.go.jp.\n * @param   {boolean}  infrared  gets the latest infrared image\n * @returns {function}           callback function\n */\nfunction getLatestDate(infrared, cb) {\n  json(\"https://himawari-8.appspot.com/latest\" + (infrared ? \"?infrared=true\" : \"\"),\n    function(error, data) {\n      if (error) throw error;\n      var latest = data.date;\n      cb(resolveDate(latest + \"Z\"));\n    });\n}\n\n/**\n * Looks at the screen resolution and figures out a zoom level that returns images at a sufficient resolution.\n */\nfunction getOptimalNumberOfBlocks() {\n  var height = document.getElementById(\"output\").clientHeight * window.devicePixelRatio;\n  var minNumber = height/WIDTH;\n\n  for (var i = 0; i < BLOCK_SIZES.length; i++) {\n    var l = BLOCK_SIZES[i];\n    if (l > minNumber) {\n      return l;\n    }\n  }\n\n  return BLOCK_SIZES[BLOCK_SIZES.length - 1];\n}\n\n// the date that is currently loaded\nvar loadedDate;\n\nfunction updateTimeAgo(date) {\n  var ago = (Date.now() - date.getTime()) / (1000 * 60);\n  document.getElementById(\"time\").innerHTML = \"<abbr title=\\\"\" + date + \"\\\">\" + Math.floor(ago) + \" minutes</abbr> ago\";\n}\n\n/**\n * Creates an image composed of tiles.\n * @param {Date object} date  The date for which to load the data.\n */\nfunction setImages(date) {\n  if (loadedDate && date.getTime() === loadedDate.getTime()) {\n    return;\n  }\n\n  // if we haven't loaded images before, we want to show progress\n  var initialLoad = !localStorage.getItem(CACHED_DATE_KEY);\n\n  // get the URLs for all tiles\n  var result = himawariURLs({\n    date: date,\n    blocks: getOptimalNumberOfBlocks()\n  });\n\n  var pixels = result.blocks * WIDTH;\n\n  var canvas = initialLoad ? document.getElementById(\"output\") : document.createElement(\"canvas\");\n  var ctx = canvas.getContext(\"2d\");\n  ctx.canvas.width = pixels;\n  ctx.canvas.height = pixels;\n\n  var q = queue();\n\n  // add image to canvas and call callback when done\n  function addImage(tile, callback) {\n    var img = new Image();\n    img.setAttribute(\"crossOrigin\", \"anonymous\");\n    img.onload = function() {\n      ctx.drawImage(img, tile.x * WIDTH, tile.y * WIDTH, WIDTH, WIDTH);\n      callback();\n    }\n    img.src = tile.url;\n  }\n\n  result.tiles.forEach(function(tile) {\n    q.defer(addImage, tile);\n  });\n\n  // wait for all images to be drawn on canvas\n  q.awaitAll(function(error) {\n    if (error) throw error;\n\n    if (!initialLoad) {\n      // copy canvas into output in one step\n      var output = document.getElementById(\"output\");\n      var outCtx = output.getContext(\"2d\")\n      outCtx.canvas.width = pixels;\n      outCtx.canvas.height = pixels;\n      outCtx.drawImage(canvas, 0, 0);\n    }\n\n    updateTimeAgo(result.date);\n    loadedDate = date;\n\n    // put date and image data in cache\n    var imageData = canvas.toDataURL(\"image/jpeg\", IMAGE_QUALITY);\n    localStorage.setItem(IMAGE_DATA_KEY, imageData);\n    localStorage.setItem(CACHED_DATE_KEY, date);\n  });\n}\n\n/* Asynchronously load latest image date and images for that date */\nfunction setLatestImages() {\n  if (!navigator.onLine) {\n    // browser is offline, no need to do this\n    return;\n  }\n\n  getLatestDate(false, function(latest) {\n    setImages(latest);\n  });\n}\n\n/** Load image from local storage */\nfunction setCachedImage() {\n  var canvas = document.getElementById(\"output\");\n  var ctx = canvas.getContext(\"2d\");\n  var date = new Date(localStorage.getItem(CACHED_DATE_KEY));\n\n  var img = new Image();\n  img.onload = function() {\n    ctx.canvas.width = img.width;\n    ctx.canvas.height = img.height;\n    ctx.drawImage(img, 0, 0);\n\n    updateTimeAgo(date);\n    loadedDate = date;\n  }\n  img.src = localStorage.getItem(IMAGE_DATA_KEY);\n}\n\n// check if there are new images form time to time\nwindow.setInterval(setLatestImages, RELOAD_INTERVAL);\n\n// also load a new image when we come back online\nwindow.addEventListener(\"online\", setLatestImages);\n\n// initial loading\nif (localStorage.getItem(CACHED_DATE_KEY)) {\n  setCachedImage();\n  setLatestImages();\n} else {\n  setLatestImages();\n}\n\n// update the time ago every 20 seconds\nwindow.setInterval(function() {\n  if (loadedDate) {\n    updateTimeAgo(loadedDate);\n  }\n}, RELOAD_TIME_INTERVAL);\n"],"names":["newQueue","concurrency","poke","starting","start","e","tasks","ended","active","abort","waiting","i","t","j","length","c","end","apply","noabort","r","error","results","notify","undefined","NaN","Error","q","noop","defer","callback","slice","call","arguments","push","await","concat","awaitAll","Infinity","Map","map","object","f","each","value","key","set","Array","isArray","o","n","dispatch","_","Dispatch","this","parseTypenames","typenames","types","trim","split","name","indexOf","hasOwnProperty","type","get","url","respond","result","status","xhr","hasResponse","response","request","event","mimeType","responseType","headers","XMLHttpRequest","user","password","timeout","XDomainRequest","test","onload","onerror","ontimeout","onreadystatechange","readyState","onprogress","header","toLowerCase","remove","data","send","post","method","fixCallback","open","has","setRequestHeader","overrideMimeType","on","responseText","defaultMimeType","objectConverter","columns","Function","JSON","stringify","join","customConverter","row","inferColumns","rows","columnSet","Object","create","forEach","column","delimiter","parse","text","convert","parseRows","token","I","N","EOF","eol","EOL","charCodeAt","replace","k","delimiterCode","a","format","formatValue","formatRows","formatRow","reFormat","RegExp","himawariURLs","options","baseURL","getBaseURL","infrared","date","resolveDate","normalizeDate","blocks","zoom","BLOCK_SIZES","level","time","getUTCHours","getUTCMinutes","getUTCSeconds","s","pad","year","getUTCFullYear","month","getUTCMonth","day","getUTCDate","tilesURL","WIDTH","tiles","y","x","getCachedUrl","BASE_URL","INFRARED","VISIBLE_LIGHT","setMinutes","getMinutes","setSeconds","parts","match","Date","UTC","cache","num","size","getLatestDate","cb","json","latest","getOptimalNumberOfBlocks","height","document","getElementById","clientHeight","window","devicePixelRatio","minNumber","l","updateTimeAgo","ago","now","getTime","innerHTML","Math","floor","setImages","addImage","tile","img","Image","setAttribute","ctx","drawImage","src","loadedDate","initialLoad","localStorage","getItem","CACHED_DATE_KEY","pixels","canvas","createElement","getContext","width","queue","output","outCtx","imageData","toDataURL","IMAGE_QUALITY","setItem","IMAGE_DATA_KEY","setLatestImages","navigator","onLine","setCachedImage","prefix","prototype","constructor","property","clear","keys","values","entries","empty","typename","T","copy","that","args","dsv","RELOAD_INTERVAL","RELOAD_TIME_INTERVAL","setInterval","addEventListener"],"mappings":"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"}