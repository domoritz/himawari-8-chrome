{"version":3,"file":"bundle.js","sources":["node_modules/d3-queue/src/queue.js","node_modules/d3-collection/src/map.js","node_modules/d3-collection/src/set.js","node_modules/d3-dispatch/src/dispatch.js","node_modules/d3-request/src/request.js","node_modules/d3-dsv/src/dsv.js","src/main.ts","node_modules/d3-queue/src/array.js","node_modules/d3-request/src/type.js","node_modules/d3-request/src/json.js","node_modules/d3-dsv/src/csv.js","node_modules/d3-dsv/src/tsv.js"],"sourcesContent":["import {slice} from \"./array\";\n\nvar noabort = {};\n\nfunction Queue(size) {\n  this._size = size;\n  this._call =\n  this._error = null;\n  this._tasks = [];\n  this._data = [];\n  this._waiting =\n  this._active =\n  this._ended =\n  this._start = 0; // inside a synchronous task callback?\n}\n\nQueue.prototype = queue.prototype = {\n  constructor: Queue,\n  defer: function(callback) {\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n    if (this._call) throw new Error(\"defer after await\");\n    if (this._error != null) return this;\n    var t = slice.call(arguments, 1);\n    t.push(callback);\n    ++this._waiting, this._tasks.push(t);\n    poke(this);\n    return this;\n  },\n  abort: function() {\n    if (this._error == null) abort(this, new Error(\"abort\"));\n    return this;\n  },\n  await: function(callback) {\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n    if (this._call) throw new Error(\"multiple await\");\n    this._call = function(error, results) { callback.apply(null, [error].concat(results)); };\n    maybeNotify(this);\n    return this;\n  },\n  awaitAll: function(callback) {\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback\");\n    if (this._call) throw new Error(\"multiple await\");\n    this._call = callback;\n    maybeNotify(this);\n    return this;\n  }\n};\n\nfunction poke(q) {\n  if (!q._start) {\n    try { start(q); } // let the current task complete\n    catch (e) {\n      if (q._tasks[q._ended + q._active - 1]) abort(q, e); // task errored synchronously\n      else if (!q._data) throw e; // await callback errored synchronously\n    }\n  }\n}\n\nfunction start(q) {\n  while (q._start = q._waiting && q._active < q._size) {\n    var i = q._ended + q._active,\n        t = q._tasks[i],\n        j = t.length - 1,\n        c = t[j];\n    t[j] = end(q, i);\n    --q._waiting, ++q._active;\n    t = c.apply(null, t);\n    if (!q._tasks[i]) continue; // task finished synchronously\n    q._tasks[i] = t || noabort;\n  }\n}\n\nfunction end(q, i) {\n  return function(e, r) {\n    if (!q._tasks[i]) return; // ignore multiple callbacks\n    --q._active, ++q._ended;\n    q._tasks[i] = null;\n    if (q._error != null) return; // ignore secondary errors\n    if (e != null) {\n      abort(q, e);\n    } else {\n      q._data[i] = r;\n      if (q._waiting) poke(q);\n      else maybeNotify(q);\n    }\n  };\n}\n\nfunction abort(q, e) {\n  var i = q._tasks.length, t;\n  q._error = e; // ignore active callbacks\n  q._data = undefined; // allow gc\n  q._waiting = NaN; // prevent starting\n\n  while (--i >= 0) {\n    if (t = q._tasks[i]) {\n      q._tasks[i] = null;\n      if (t.abort) {\n        try { t.abort(); }\n        catch (e) { /* ignore */ }\n      }\n    }\n  }\n\n  q._active = NaN; // allow notification\n  maybeNotify(q);\n}\n\nfunction maybeNotify(q) {\n  if (!q._active && q._call) {\n    var d = q._data;\n    q._data = undefined; // allow gc\n    q._call(q._error, d);\n  }\n}\n\nexport default function queue(concurrency) {\n  if (concurrency == null) concurrency = Infinity;\n  else if (!((concurrency = +concurrency) >= 1)) throw new Error(\"invalid concurrency\");\n  return new Queue(concurrency);\n}\n","export var prefix = \"$\";\n\nfunction Map() {}\n\nMap.prototype = map.prototype = {\n  constructor: Map,\n  has: function(key) {\n    return (prefix + key) in this;\n  },\n  get: function(key) {\n    return this[prefix + key];\n  },\n  set: function(key, value) {\n    this[prefix + key] = value;\n    return this;\n  },\n  remove: function(key) {\n    var property = prefix + key;\n    return property in this && delete this[property];\n  },\n  clear: function() {\n    for (var property in this) if (property[0] === prefix) delete this[property];\n  },\n  keys: function() {\n    var keys = [];\n    for (var property in this) if (property[0] === prefix) keys.push(property.slice(1));\n    return keys;\n  },\n  values: function() {\n    var values = [];\n    for (var property in this) if (property[0] === prefix) values.push(this[property]);\n    return values;\n  },\n  entries: function() {\n    var entries = [];\n    for (var property in this) if (property[0] === prefix) entries.push({key: property.slice(1), value: this[property]});\n    return entries;\n  },\n  size: function() {\n    var size = 0;\n    for (var property in this) if (property[0] === prefix) ++size;\n    return size;\n  },\n  empty: function() {\n    for (var property in this) if (property[0] === prefix) return false;\n    return true;\n  },\n  each: function(f) {\n    for (var property in this) if (property[0] === prefix) f(this[property], property.slice(1), this);\n  }\n};\n\nfunction map(object, f) {\n  var map = new Map;\n\n  // Copy constructor.\n  if (object instanceof Map) object.each(function(value, key) { map.set(key, value); });\n\n  // Index array by numeric index or specified key function.\n  else if (Array.isArray(object)) {\n    var i = -1,\n        n = object.length,\n        o;\n\n    if (f == null) while (++i < n) map.set(i, object[i]);\n    else while (++i < n) map.set(f(o = object[i], i, object), o);\n  }\n\n  // Convert object to map.\n  else if (object) for (var key in object) map.set(key, object[key]);\n\n  return map;\n}\n\nexport default map;\n","import {default as map, prefix} from \"./map\";\n\nfunction Set() {}\n\nvar proto = map.prototype;\n\nSet.prototype = set.prototype = {\n  constructor: Set,\n  has: proto.has,\n  add: function(value) {\n    value += \"\";\n    this[prefix + value] = value;\n    return this;\n  },\n  remove: proto.remove,\n  clear: proto.clear,\n  values: proto.keys,\n  size: proto.size,\n  empty: proto.empty,\n  each: proto.each\n};\n\nfunction set(object, f) {\n  var set = new Set;\n\n  // Copy constructor.\n  if (object instanceof Set) object.each(function(value) { set.add(value); });\n\n  // Otherwise, assume it’s an array.\n  else if (object) {\n    var i = -1, n = object.length;\n    if (f == null) while (++i < n) set.add(object[i]);\n    else while (++i < n) set.add(f(object[i], i, object));\n  }\n\n  return set;\n}\n\nexport default set;\n","var noop = {value: function() {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import {map} from \"d3-collection\";\nimport {dispatch} from \"d3-dispatch\";\n\nexport default function(url, callback) {\n  var request,\n      event = dispatch(\"beforesend\", \"progress\", \"load\", \"error\"),\n      mimeType,\n      headers = map(),\n      xhr = new XMLHttpRequest,\n      user = null,\n      password = null,\n      response,\n      responseType,\n      timeout = 0;\n\n  // If IE does not support CORS, use XDomainRequest.\n  if (typeof XDomainRequest !== \"undefined\"\n      && !(\"withCredentials\" in xhr)\n      && /^(http(s)?:)?\\/\\//.test(url)) xhr = new XDomainRequest;\n\n  \"onload\" in xhr\n      ? xhr.onload = xhr.onerror = xhr.ontimeout = respond\n      : xhr.onreadystatechange = function(o) { xhr.readyState > 3 && respond(o); };\n\n  function respond(o) {\n    var status = xhr.status, result;\n    if (!status && hasResponse(xhr)\n        || status >= 200 && status < 300\n        || status === 304) {\n      if (response) {\n        try {\n          result = response.call(request, xhr);\n        } catch (e) {\n          event.call(\"error\", request, e);\n          return;\n        }\n      } else {\n        result = xhr;\n      }\n      event.call(\"load\", request, result);\n    } else {\n      event.call(\"error\", request, o);\n    }\n  }\n\n  xhr.onprogress = function(e) {\n    event.call(\"progress\", request, e);\n  };\n\n  request = {\n    header: function(name, value) {\n      name = (name + \"\").toLowerCase();\n      if (arguments.length < 2) return headers.get(name);\n      if (value == null) headers.remove(name);\n      else headers.set(name, value + \"\");\n      return request;\n    },\n\n    // If mimeType is non-null and no Accept header is set, a default is used.\n    mimeType: function(value) {\n      if (!arguments.length) return mimeType;\n      mimeType = value == null ? null : value + \"\";\n      return request;\n    },\n\n    // Specifies what type the response value should take;\n    // for instance, arraybuffer, blob, document, or text.\n    responseType: function(value) {\n      if (!arguments.length) return responseType;\n      responseType = value;\n      return request;\n    },\n\n    timeout: function(value) {\n      if (!arguments.length) return timeout;\n      timeout = +value;\n      return request;\n    },\n\n    user: function(value) {\n      return arguments.length < 1 ? user : (user = value == null ? null : value + \"\", request);\n    },\n\n    password: function(value) {\n      return arguments.length < 1 ? password : (password = value == null ? null : value + \"\", request);\n    },\n\n    // Specify how to convert the response content to a specific type;\n    // changes the callback value on \"load\" events.\n    response: function(value) {\n      response = value;\n      return request;\n    },\n\n    // Alias for send(\"GET\", …).\n    get: function(data, callback) {\n      return request.send(\"GET\", data, callback);\n    },\n\n    // Alias for send(\"POST\", …).\n    post: function(data, callback) {\n      return request.send(\"POST\", data, callback);\n    },\n\n    // If callback is non-null, it will be used for error and load events.\n    send: function(method, data, callback) {\n      xhr.open(method, url, true, user, password);\n      if (mimeType != null && !headers.has(\"accept\")) headers.set(\"accept\", mimeType + \",*/*\");\n      if (xhr.setRequestHeader) headers.each(function(value, name) { xhr.setRequestHeader(name, value); });\n      if (mimeType != null && xhr.overrideMimeType) xhr.overrideMimeType(mimeType);\n      if (responseType != null) xhr.responseType = responseType;\n      if (timeout > 0) xhr.timeout = timeout;\n      if (callback == null && typeof data === \"function\") callback = data, data = null;\n      if (callback != null && callback.length === 1) callback = fixCallback(callback);\n      if (callback != null) request.on(\"error\", callback).on(\"load\", function(xhr) { callback(null, xhr); });\n      event.call(\"beforesend\", request, xhr);\n      xhr.send(data == null ? null : data);\n      return request;\n    },\n\n    abort: function() {\n      xhr.abort();\n      return request;\n    },\n\n    on: function() {\n      var value = event.on.apply(event, arguments);\n      return value === event ? request : value;\n    }\n  };\n\n  if (callback != null) {\n    if (typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    return request.get(callback);\n  }\n\n  return request;\n}\n\nfunction fixCallback(callback) {\n  return function(error, xhr) {\n    callback(error == null ? xhr : null);\n  };\n}\n\nfunction hasResponse(xhr) {\n  var type = xhr.responseType;\n  return type && type !== \"text\"\n      ? xhr.response // null on error\n      : xhr.responseText; // \"\" on error\n}\n","function objectConverter(columns) {\n  return new Function(\"d\", \"return {\" + columns.map(function(name, i) {\n    return JSON.stringify(name) + \": d[\" + i + \"]\";\n  }).join(\",\") + \"}\");\n}\n\nfunction customConverter(columns, f) {\n  var object = objectConverter(columns);\n  return function(row, i) {\n    return f(object(row), i, columns);\n  };\n}\n\n// Compute unique columns in order of discovery.\nfunction inferColumns(rows) {\n  var columnSet = Object.create(null),\n      columns = [];\n\n  rows.forEach(function(row) {\n    for (var column in row) {\n      if (!(column in columnSet)) {\n        columns.push(columnSet[column] = column);\n      }\n    }\n  });\n\n  return columns;\n}\n\nexport default function(delimiter) {\n  var reFormat = new RegExp(\"[\\\"\" + delimiter + \"\\n\\r]\"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  function parse(text, f) {\n    var convert, columns, rows = parseRows(text, function(row, i) {\n      if (convert) return convert(row, i - 1);\n      columns = row, convert = f ? customConverter(row, f) : objectConverter(row);\n    });\n    rows.columns = columns;\n    return rows;\n  }\n\n  function parseRows(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I, c;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.slice(j + 1, i).replace(/\"\"/g, \"\\\"\");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var k = 1;\n        c = text.charCodeAt(I++);\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.slice(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.slice(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && (a = f(a, n++)) == null) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  }\n\n  function format(rows, columns) {\n    if (columns == null) columns = inferColumns(rows);\n    return [columns.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return columns.map(function(column) {\n        return formatValue(row[column]);\n      }).join(delimiter);\n    })).join(\"\\n\");\n  }\n\n  function formatRows(rows) {\n    return rows.map(formatRow).join(\"\\n\");\n  }\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return text == null ? \"\"\n        : reFormat.test(text += \"\") ? \"\\\"\" + text.replace(/\\\"/g, \"\\\"\\\"\") + \"\\\"\"\n        : text;\n  }\n\n  return {\n    parse: parse,\n    parseRows: parseRows,\n    format: format,\n    formatRows: formatRows\n  };\n}\n","import {queue} from 'd3-queue';\nimport {json} from 'd3-request';\n\n// base url for images\nconst HIMAWARI_BASE_URL = \"https://himawari8-dl.nict.go.jp/himawari8/img/\";\nconst DSCOVR_BASE_URL = \"https://epic.gsfc.nasa.gov/archive/\";\n\nconst GOES_EAST_URL = \"http://goes.gsfc.nasa.gov/goescolor/goeseast/overview2/color_lrg/latestfull.jpg\";\nconst GOES_WEST_URL = \"http://goes.gsfc.nasa.gov/goescolor/goeswest/overview2/color_lrg/latestfull.jpg\";\n\n// links to online image explorers\nconst HIMAWARI_EXPLORER = \"http://himawari8.nict.go.jp/himawari8-image.htm?sI=D531106\";\nconst DSCOVR_EXPLORER = \"https://epic.gsfc.nasa.gov\";\nconst DSCOVR_EXPLORER_ENHANCED = DSCOVR_EXPLORER + \"/enhanced\";\n\n// image types\nconst INFRARED = \"INFRARED_FULL\";\nconst VISIBLE_LIGHT = \"D531106\";\nconst DSCOVR_EPIC = \"EPIC\";\nconst DSCOVR_EPIC_ENHANCED = \"EPIC_ENHANCED\";\nconst GOES_EAST = \"GOES_EAST\";  // GOES 13\nconst GOES_WEST = \"GOES_WEST\";  // GOES 15\n\ntype ImageType = typeof INFRARED | typeof VISIBLE_LIGHT | typeof DSCOVR_EPIC | typeof DSCOVR_EPIC_ENHANCED | typeof GOES_EAST | typeof GOES_WEST;\n\nconst WIDTH = 550;\nconst BLOCK_SIZES = [1, 4, 8, 16, 20];\n\nconst DSCOVR_WIDTH = 2048;\nconst GOES_WIDTH = 3072;\n\nconst IMAGE_QUALITY = 0.9;\nconst RELOAD_INTERVAL = 1 * 60 * 1000;  // 1 minutes\nconst RELOAD_TIME_INTERVAL = 10 * 1000;  // 10 seconds\n\n// local storage keys\nconst IMAGE_DATA_KEY = \"imageData\";\nconst CACHED_DATE_KEY = \"cachedDate\";\nconst CACHED_IMAGE_TYPE_KEY = \"cachedImageType\";\n\n// unknown date\nconst UNKNOWN: Date = null;\n\nconst isExtension = window['chrome'] && !!window['chrome'].storage;\n\ninterface Tile {\n  x: number,\n  y: number,\n  url: string,\n  name: string\n}\n\n/**\n * Returns an array of objects containing URLs and metadata\n * for Himawari 8 image tiles based on a given date.\n * Options:\n * - date: Date object\n * - type: boolean (default: visible light)\n * - zoom: number (default: 1)\n * - blocks: alternative to zoom, how many images per row/column (default: 1)\n *      Has to be a valid block number (1, 4, 8, 16, 20)\n *\n * @param  {Object}       options\n */\nfunction himawariURLs(options: {date: Date, type?: ImageType, zoom?: number, blocks?: number}) {\n  const baseURL = HIMAWARI_BASE_URL + (options.type || VISIBLE_LIGHT);\n  const date = options.date;\n\n  // Define some image parameters\n  const blocks = options.blocks || (options.zoom ? BLOCK_SIZES[options.zoom - 1] : BLOCK_SIZES[0]);\n  const level = blocks + 'd';\n  const time = [date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()].map(function (s) { return pad(s, 2); }).join(\"\");\n  const year = date.getUTCFullYear();\n  const month = pad(date.getUTCMonth() + 1, 2);\n  const day = pad(date.getUTCDate(), 2);\n\n  // compose URL\n  const tilesURL = [baseURL, level, WIDTH, year, month, day, time].join(\"/\");\n  const tiles: Tile[] = [];\n\n  for (let y = 0; y < blocks; y++) {\n    for (let x = 0; x < blocks; x++) {\n      const name = x + \"_\" + y + \".png\";\n      const url = tilesURL + \"_\" + name;\n\n      tiles.push({\n        name: name,\n        url: getCachedUrl(url),\n        x: x,\n        y: y\n      });\n    }\n  }\n\n  return {\n    tiles: tiles,\n    blocks: blocks,\n    date: date\n  };\n}\n\n/**\n * Parses a date string into a date object.\n * @param   {string | Date} date  Date as string or date object\n * @returns {Date}                Date object\n */\nfunction resolveDate(date: string | Date) {\n  if (typeof date === \"string\") {\n    // Don't use Date.parse because it doesn't work with YYYY-MM-DD HH:MM:SSZ\n    const parts = date.match(/(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})Z/);\n    parts[2] = String(+parts[2] - 1); // months are zero-based\n    return new Date(Date.UTC.apply(this, parts.slice(1)));\n  } else {\n    return date;\n  }\n}\n\n/**\n * Create a cached URL thanks to our friends at Google.\n * See https://gist.github.com/carlo/5379498\n *\n * Default caching is 5 days, in seconds\n */\nfunction getCachedUrl(url: string, cache = 5 * 24 * 60 * 60) {\n  return `https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url=${url}&container=focus&refresh=${cache}`;\n}\n\n/**\n * Pads a number with trailing zeros and makes it a string.\n */\nfunction pad(num: string | number, size: number) {\n  let s = num + \"\";\n  while (s.length < size) {\n    s = \"0\" + s;\n  }\n  return s;\n}\n\n/**\n * Get the date of the latest himawari image by making an Ajax request.\n * @param   {string}  imageType  The type of image\n * @returns {function}           callback function\n */\nfunction getLatestHimawariDate(imageType: ImageType, cb: (date: Date) => void) {\n  json(\"https://himawari-8.appspot.com/latest\" + (imageType === INFRARED ? \"?infrared=true\" : \"\"),\n    (error, data: {date: string}) => {\n      if (error) throw error;\n      const latest = data.date;\n      cb(resolveDate(latest + \"Z\"));\n    });\n}\n\nfunction getLatestDscovrDate(imageType: ImageType, cb: (latest: {date: Date, image: string}) => void) {\n  json(\"http://epic.gsfc.nasa.gov/api/\" + (imageType === DSCOVR_EPIC_ENHANCED ? \"enhanced\" : \"natural\"),\n    (error, data: {date: string, image: string}[]) => {\n      if (error) throw error;\n      if (data.length === 0) return;\n      const latest = data[data.length - 1];\n      cb({\n        date: resolveDate(latest.date + \"Z\"),\n        image: latest.image\n      });\n    });\n}\n\n/**\n * Looks at the screen resolution and figures out a zoom level that returns images at a sufficient resolution.\n */\nfunction getOptimalNumberOfBlocks(): number {\n  const height = (document.getElementById(\"output\")!).clientHeight * window.devicePixelRatio;\n  const minNumber = height / WIDTH;\n\n  for (let i = 0; i < BLOCK_SIZES.length; i++) {\n    const l = BLOCK_SIZES[i];\n    if (l > minNumber) {\n      return l;\n    }\n  }\n\n  return BLOCK_SIZES[BLOCK_SIZES.length - 1];\n}\n\n// the date that is currently loaded\nlet loadedDate: Date = null;\nlet loadedType: ImageType = null;\n\nfunction timeSince(date: Date) {\n  const seconds = Math.floor(((new Date()).getTime() - date.getTime()) / 1000);\n\n  let interval = Math.floor(seconds / 31536000);\n\n  if (interval > 1) {\n    return interval + \" years\";\n  }\n  interval = Math.floor(seconds / 2592000);\n  if (interval > 1) {\n    return interval + \" months\";\n  }\n  interval = Math.floor(seconds / 86400);\n  if (interval > 1) {\n    return interval + \" days\";\n  }\n  interval = Math.floor(seconds / 3600);\n  if (interval > 1) {\n    return interval + \" hours\";\n  }\n  interval = Math.floor(seconds / 60);\n  if (interval > 1) {\n    return interval + \" minutes\";\n  }\n  return Math.floor(seconds) + \" seconds\";\n}\n\nfunction updateTimeAgo(date: Date) {\n  if (date === UNKNOWN) {\n    document.getElementById(\"time\").innerHTML = \"\";\n  } else {\n    document.getElementById(\"time\").innerHTML = \"<abbr title=\\\"\" + date + \"\\\">\" + timeSince(date) + \"</abbr> ago\";\n  }\n}\n\n/*\n * Set the right class on the body so that we can have different css.\n */\nfunction setBodyClass(imageType: ImageType) {\n  document.body.classList.remove(\"himawari\");\n  document.body.classList.remove(\"dscovr\");\n  document.body.classList.remove(\"goes\");\n\n  switch (imageType) {\n    case INFRARED:\n    case VISIBLE_LIGHT:\n      document.body.classList.add(\"himawari\");\n      break;\n    case DSCOVR_EPIC:\n    case DSCOVR_EPIC_ENHANCED:\n      document.body.classList.add(\"dscovr\");\n      break;\n    case GOES_EAST:\n    case GOES_WEST:\n      document.body.classList.add(\"goes\");\n      break;\n    default:\n      console.warn(\"Unknown image type\", imageType);\n  }\n}\n\nfunction updateStateAndUI(date: Date, imageType: ImageType) {\n  updateTimeAgo(date);\n  loadedDate = date;\n  setBodyClass(imageType);\n  loadedType = imageType;\n}\n\n/**\n * Creates an image composed of tiles.\n * @param {Date object} date  The date for which to load the data.\n */\nfunction setHimawariImages(date: Date, imageType: ImageType) {\n  // no need to set images if we have up to date images and the image type has not changed\n  if (loadedDate && date.getTime() === loadedDate.getTime() && loadedType === imageType) {\n    return;\n  }\n\n  // if we haven't loaded images before, we want to show progress\n  const initialLoad = !localStorage.getItem(CACHED_DATE_KEY);\n\n  // immediately set the type and body class beacuse we are not loading in the background\n  if (initialLoad) {\n    updateStateAndUI(date, imageType);\n  }\n\n  // get the URLs for all tiles\n  const result = himawariURLs({\n    date: date,\n    blocks: getOptimalNumberOfBlocks(),\n    type: imageType\n  });\n\n  const pixels = result.blocks * WIDTH;\n\n  const canvas = initialLoad ? document.getElementById(\"output\") as HTMLCanvasElement : document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\")!;\n  ctx.canvas.width = pixels;\n  ctx.canvas.height = pixels;\n\n  const q = queue();\n\n  // add image to canvas and call callback when done\n  function addImage(tile: Tile, callback: () => void) {\n    const img = new Image();\n    img.setAttribute(\"crossOrigin\", \"anonymous\");\n    img.onload = () => {\n      ctx.drawImage(img, tile.x * WIDTH, tile.y * WIDTH, WIDTH, WIDTH);\n      callback();\n    };\n    img.src = tile.url;\n  }\n\n  result.tiles.forEach((tile) => {\n    q.defer(addImage, tile);\n  });\n\n  // wait for all images to be drawn on canvas\n  q.awaitAll((error) => {\n    if (error) throw error;\n\n    if (!initialLoad) {\n      // copy canvas into output in one step\n      const output = document.getElementById(\"output\") as HTMLCanvasElement;\n      const outCtx = output.getContext(\"2d\");\n      outCtx.canvas.width = pixels;\n      outCtx.canvas.height = pixels;\n      outCtx.drawImage(canvas, 0, 0);\n    }\n\n    updateStateAndUI(date, imageType);\n\n    // put date and image data in cache\n    const imageData = canvas.toDataURL(\"image/jpeg\", IMAGE_QUALITY);\n    localStorage.setItem(IMAGE_DATA_KEY, imageData);\n    localStorage.setItem(CACHED_DATE_KEY, date.toDateString());\n    localStorage.setItem(CACHED_IMAGE_TYPE_KEY, imageType);\n  });\n}\n\nfunction setDscovrImage(latest: {date: Date, image: string}, imageType: ImageType) {\n  // no need to set images if we have up to date images and the image type has not changed\n  if (loadedDate && latest.date.getTime() === loadedDate.getTime() && loadedType === imageType) {\n    return;\n  }\n\n  // if we haven't loaded images before, we want to show progress\n  const initialLoad = !localStorage.getItem(CACHED_DATE_KEY);\n\n  // immediately set the type and body class beacuse we are not loading in the background\n  if (initialLoad) {\n    updateStateAndUI(latest.date, imageType);\n  }\n\n  const canvas = initialLoad ? document.getElementById(\"output\") as HTMLCanvasElement : document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  ctx.canvas.width = DSCOVR_WIDTH;\n  ctx.canvas.height = DSCOVR_WIDTH;\n\n  const img = new Image();\n  img.setAttribute(\"crossOrigin\", \"anonymous\");\n  img.onload = () => {\n    ctx.drawImage(img, 0, 0);\n\n    if (!initialLoad) {\n      // copy canvas into output in one step\n      const output = document.getElementById(\"output\") as HTMLCanvasElement;\n      const outCtx = output.getContext(\"2d\");\n      outCtx.canvas.width = DSCOVR_WIDTH;\n      outCtx.canvas.height = DSCOVR_WIDTH;\n      outCtx.drawImage(canvas, 0, 0);\n    }\n\n    updateStateAndUI(latest.date, imageType);\n\n    // put date and image data in cache\n    const imageData = canvas.toDataURL(\"image/jpeg\", IMAGE_QUALITY);\n    localStorage.setItem(IMAGE_DATA_KEY, imageData);\n    localStorage.setItem(CACHED_DATE_KEY, latest.date.toDateString());\n    localStorage.setItem(CACHED_IMAGE_TYPE_KEY, imageType);\n  };\n  const type = imageType === DSCOVR_EPIC_ENHANCED ? \"enhanced\" : \"natural\";\n  const month = pad(latest.date.getMonth() + 1, 2);\n  const date = pad(latest.date.getDate(), 2);\n  img.src = getCachedUrl(`${DSCOVR_BASE_URL}${type}/${latest.date.getFullYear()}/${month}/${date}/png/${latest.image}.png`);\n}\n\nfunction setGoesImage(imageType: ImageType) {\n  // if we haven't loaded images before, we want to show progress\n  const key = localStorage.getItem(CACHED_IMAGE_TYPE_KEY);\n  const initialLoad = !key || (key !== GOES_EAST && key !== GOES_WEST);\n\n  // immediately set the type and body class beacuse we are not loading in the background\n  if (initialLoad) {\n    updateStateAndUI(UNKNOWN, imageType);\n  }\n\n  const canvas = initialLoad ? document.getElementById(\"output\") as HTMLCanvasElement : document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  ctx.canvas.width = GOES_WIDTH;\n  ctx.canvas.height = GOES_WIDTH;\n\n  const img = new Image();\n  img.setAttribute(\"crossOrigin\", \"anonymous\");\n  img.onload = () => {\n    ctx.drawImage(img, 0, 0);\n\n    if (!initialLoad) {\n      // copy canvas into output in one step\n      const output = document.getElementById(\"output\") as HTMLCanvasElement;\n      const outCtx = output.getContext(\"2d\");\n      outCtx.canvas.width = GOES_WIDTH;\n      outCtx.canvas.height = GOES_WIDTH;\n      outCtx.drawImage(canvas, 0, 0);\n    }\n\n    updateStateAndUI(UNKNOWN, imageType);\n\n    // put date and image data in cache\n    const imageData = canvas.toDataURL(\"image/jpeg\", IMAGE_QUALITY);\n    localStorage.setItem(IMAGE_DATA_KEY, imageData);\n    localStorage.setItem(CACHED_DATE_KEY, String(UNKNOWN));\n    localStorage.setItem(CACHED_IMAGE_TYPE_KEY, imageType);\n  };\n\n  img.src = getCachedUrl(imageType === GOES_WEST ? GOES_WEST_URL : GOES_EAST_URL, 60*60);\n}\n\n/* Asynchronously load latest image(s) date and images for that date */\nfunction setLatestImage() {\n  if (!navigator.onLine) {\n    // browser is offline, no need to do this\n    return;\n  }\n\n  function himawariCallback(imageType: ImageType) {\n    getLatestHimawariDate(imageType, (latest: Date) => {\n      setHimawariImages(latest, imageType);\n    });\n  }\n\n  function dscovrCallback(imageType: ImageType) {\n    getLatestDscovrDate(imageType, (latest: {date: Date, image: string}) => {\n      setDscovrImage(latest, imageType);\n    });\n  }\n\n  function goesCallback(imageType: ImageType) {\n    setGoesImage(imageType);\n  }\n\n  if (isExtension) {\n    const query = {\n      imageType: VISIBLE_LIGHT\n    };\n\n    const callback = (items: {imageType: ImageType}) => {\n      switch (items.imageType) {\n        case DSCOVR_EPIC:\n        case DSCOVR_EPIC_ENHANCED:\n          dscovrCallback(items.imageType);\n          break;\n        case GOES_EAST:\n        case GOES_WEST:\n          goesCallback(items.imageType);\n          break;\n        case INFRARED:\n        case VISIBLE_LIGHT:\n        default:\n          himawariCallback(items.imageType);\n          break;\n      }\n    }\n\n    if (window['browser']) {\n      // Firefox uses a promise based API.\n      window['browser'].storage.sync.get(query).then(callback);\n    } else {\n      // Chrome uses callbacks.\n      window['chrome'].storage.sync.get(query, callback);\n    };\n  } else {\n    // if we are not in the extension, let's always load visible light\n    himawariCallback(VISIBLE_LIGHT);\n  }\n}\n\n/** Load image from local storage */\nfunction setCachedImage() {\n  const canvas = document.getElementById(\"output\") as HTMLCanvasElement;\n  const ctx = canvas.getContext(\"2d\");\n  const date = new Date(localStorage.getItem(CACHED_DATE_KEY));\n\n  const img = new Image();\n  img.onload = () => {\n    ctx.canvas.width = img.width;\n    ctx.canvas.height = img.height;\n    ctx.drawImage(img, 0, 0);\n\n    updateStateAndUI(date, localStorage.getItem(CACHED_IMAGE_TYPE_KEY) as ImageType);\n  };\n  img.src = localStorage.getItem(IMAGE_DATA_KEY);\n}\n\n// check if there are new images form time to time\nwindow.setInterval(setLatestImage, RELOAD_INTERVAL);\n\n// also load a new image when we come back online\nwindow.addEventListener(\"online\", setLatestImage);\n\n// initial loading\nif (localStorage.getItem(CACHED_DATE_KEY)) {\n  setCachedImage();\n}\nsetLatestImage();\n\n// update the time ago\nwindow.setInterval(() => {\n  if (loadedDate) {\n    updateTimeAgo(loadedDate);\n  }\n}, RELOAD_TIME_INTERVAL);\n\n// hide some things if we are not an extension\nif (isExtension) {\n  // when we are in an extension and the storage updates, try to load the new image\n  window['chrome'].storage.onChanged.addListener(setLatestImage);\n\n  document.body.classList.add(\"extension\");\n  document.getElementById(\"go-to-options\").addEventListener(\"click\", () => {\n    window['chrome'].runtime.openOptionsPage();\n  });\n}\n\ndocument.getElementById(\"explore\").addEventListener(\"click\", () => {\n  window.open(loadedType === DSCOVR_EPIC ? DSCOVR_EXPLORER : loadedType === DSCOVR_EPIC_ENHANCED ? DSCOVR_EXPLORER_ENHANCED : HIMAWARI_EXPLORER, \"_self\");\n});\n","export var slice = [].slice;\n","import request from \"./request\";\n\nexport default function(defaultMimeType, response) {\n  return function(url, callback) {\n    var r = request(url).mimeType(defaultMimeType).response(response);\n    if (callback != null) {\n      if (typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n      return r.get(callback);\n    }\n    return r;\n  };\n}\n","import type from \"./type\";\n\nexport default type(\"application/json\", function(xhr) {\n  return JSON.parse(xhr.responseText);\n});\n","import dsv from \"./dsv\";\n\nvar csv = dsv(\",\");\n\nexport var csvParse = csv.parse;\nexport var csvParseRows = csv.parseRows;\nexport var csvFormat = csv.format;\nexport var csvFormatRows = csv.formatRows;\n","import dsv from \"./dsv\";\n\nvar tsv = dsv(\"\\t\");\n\nexport var tsvParse = tsv.parse;\nexport var tsvParseRows = tsv.parseRows;\nexport var tsvFormat = tsv.format;\nexport var tsvFormatRows = tsv.formatRows;\n"],"names":["Queue","size","this","_size","_call","_error","_tasks","_data","_waiting","_active","_ended","_start","poke","q","start","e","abort","i","t","j","length","c","end","apply","noabort","r","maybeNotify","undefined","NaN","d","queue","concurrency","Infinity","Error","Map","map","object","f","each","value","key","set","Array","isArray","o","n","Set","dispatch","arguments","_","Dispatch","parseTypenames","typenames","types","trim","split","name","indexOf","slice","hasOwnProperty","type","get","callback","noop","concat","push","fixCallback","error","xhr","hasResponse","responseType","response","responseText","objectConverter","columns","Function","JSON","stringify","join","customConverter","row","inferColumns","rows","columnSet","Object","create","forEach","column","options","baseURL","HIMAWARI_BASE_URL","VISIBLE_LIGHT","date","blocks","zoom","BLOCK_SIZES","level","time","getUTCHours","getUTCMinutes","getUTCSeconds","s","pad","year","getUTCFullYear","month","getUTCMonth","day","getUTCDate","tilesURL","WIDTH","tiles","y","x","name_1","url","getCachedUrl","parts","match","String","Date","UTC","cache","num","imageType","cb","json","INFRARED","data","latest","resolveDate","DSCOVR_EPIC_ENHANCED","image","minNumber","document","getElementById","clientHeight","window","devicePixelRatio","l","seconds","Math","floor","getTime","interval","innerHTML","UNKNOWN","timeSince","body","classList","remove","add","DSCOVR_EPIC","GOES_EAST","GOES_WEST","console","warn","updateTimeAgo","loadedDate","setBodyClass","loadedType","tile","img","Image","setAttribute","onload","ctx","drawImage","src","initialLoad","localStorage","getItem","CACHED_DATE_KEY","updateStateAndUI","result","himawariURLs","getOptimalNumberOfBlocks","pixels","canvas","createElement","getContext","width","height","defer","addImage","awaitAll","outCtx","imageData","toDataURL","IMAGE_QUALITY","setItem","IMAGE_DATA_KEY","toDateString","CACHED_IMAGE_TYPE_KEY","DSCOVR_WIDTH","getMonth","getDate","DSCOVR_BASE_URL","getFullYear","GOES_WIDTH","GOES_WEST_URL","GOES_EAST_URL","getLatestHimawariDate","setHimawariImages","getLatestDscovrDate","setDscovrImage","setGoesImage","navigator","onLine","isExtension","query","items","dscovrCallback","goesCallback","himawariCallback","storage","sync","then","prototype","constructor","call","await","results","has","property","clear","keys","values","entries","empty","proto","on","typename","T","copy","that","args","respond","status","request","event","mimeType","headers","XMLHttpRequest","user","password","timeout","XDomainRequest","test","onerror","ontimeout","onreadystatechange","readyState","onprogress","header","toLowerCase","send","post","method","open","setRequestHeader","overrideMimeType","defaultMimeType","parse","delimiter","parseRows","text","token","I","N","EOF","eol","EOL","charCodeAt","replace","k","delimiterCode","a","formatRow","formatValue","reFormat","RegExp","convert","format","formatRows","dsv","setInterval","setLatestImage","addEventListener","setCachedImage","onChanged","addListener","runtime","openOptionsPage","DSCOVR_EXPLORER"],"mappings":"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"}